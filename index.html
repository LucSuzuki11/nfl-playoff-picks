<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NFL Playoff Picks</title>
  <style>
    body { font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial; margin: 18px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; margin: 12px 0; }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    input[type="number"], input[type="text"] { padding: 10px; border: 1px solid #ccc; border-radius: 10px; }
    input[type="number"] { width: 110px; }
    input[type="text"] { width: 240px; }
    button { padding: 12px 14px; border: 0; border-radius: 12px; background: #111; color: #fff; font-weight: 600; }
    .muted { color: #666; font-size: 14px; }
    .winner { font-weight: 800; }
    .error { color: #b00020; font-weight: 700; }
    .ok { color: #0a7a2f; font-weight: 700; }
  </style>
</head>
<body>
  <h2>NFL Playoff Picks</h2>
  <div class="muted" id="roundLabel"></div>

  <div class="card">
    <div class="row">
      <label>
        Your name<br />
        <input id="name" type="text" placeholder="Your name" />
      </label>
      <div class="muted">Winner is auto-decided by scores.</div>
    </div>
  </div>

  <div id="games"></div>

  <button id="submitBtn">Submit Picks</button>
  <p id="status" class="muted"></p>

  <!-- Hidden form POST (avoids CORS + "Failed to fetch") -->
  <iframe name="hidden_iframe" style="width:100%; height:120px; border:1px solid #ddd;"></iframe>
  <form id="postForm" target="hidden_iframe" method="POST" style="display:none;">
    <input name="round" id="f_round" />
    <input name="name" id="f_name" />
    <input name="picks" id="f_picks" />
  </form>

<script>
  // ✅ MUST be your Apps Script Web App URL ending in /exec
  const API_URL = "https://script.google.com/macros/s/AKfycbzNYIqTksrJnjp5U1dSC9ttR9mrJhC4jiyvrvAAzjh23fVaLw8sYA56TafvU0_V3R6e/exec";

  // Change these each round
  const ROUND = "Wild Card";
  const MATCHUPS = [
    { matchId: "WC1", teamA: "Bills", teamB: "Steelers" },
    { matchId: "WC2", teamA: "Chiefs", teamB: "Dolphins" },
    { matchId: "WC3", teamA: "Texans", teamB: "Browns" },
    { matchId: "WC4", teamA: "Lions", teamB: "Rams" },
    { matchId: "WC5", teamA: "Buccaneers", teamB: "Eagles" },
    { matchId: "WC6", teamA: "Cowboys", teamB: "Packers" }
  ];

  document.getElementById("roundLabel").textContent = `Round: ${ROUND}`;

  const gamesEl = document.getElementById("games");

  function winnerFromScores(a, b, teamA, teamB) {
    if (a > b) return teamA;
    if (b > a) return teamB;
    return "TIE";
  }

  function makeGameCard(m, idx) {
    const idA = `a_${idx}`, idB = `b_${idx}`, winId = `w_${idx}`;
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div><b>${m.teamA}</b> vs <b>${m.teamB}</b></div>
      <div class="row" style="margin-top:10px;">
        <label>${m.teamA} score<br><input type="number" min="0" max="99" step="1" id="${idA}" /></label>
        <label>${m.teamB} score<br><input type="number" min="0" max="99" step="1" id="${idB}" /></label>
        <div class="muted">Winner: <span class="winner" id="${winId}">—</span></div>
      </div>
      <div class="muted">Match ID: ${m.matchId}</div>
    `;

    const aEl = div.querySelector(`#${idA}`);
    const bEl = div.querySelector(`#${idB}`);
    const wEl = div.querySelector(`#${winId}`);

    function update() {
      if (aEl.value === "" || bEl.value === "") {
        wEl.textContent = "—";
        return;
      }
      const a = Number(aEl.value);
      const b = Number(bEl.value);
      wEl.textContent = winnerFromScores(a, b, m.teamA, m.teamB);
    }

    aEl.addEventListener("input", update);
    bEl.addEventListener("input", update);

    return div;
  }

  MATCHUPS.forEach((m, idx) => gamesEl.appendChild(makeGameCard(m, idx)));

  function getPicks() {
    const picks = [];
    for (let i = 0; i < MATCHUPS.length; i++) {
      const m = MATCHUPS[i];
      const scoreAEl = document.getElementById(`a_${i}`);
      const scoreBEl = document.getElementById(`b_${i}`);

      if (scoreAEl.value === "" || scoreBEl.value === "") {
        throw new Error(`Missing score for: ${m.teamA} vs ${m.teamB}`);
      }

      const scoreA = Number(scoreAEl.value);
      const scoreB = Number(scoreBEl.value);

      if (!Number.isInteger(scoreA) || !Number.isInteger(scoreB) || scoreA < 0 || scoreB < 0 || scoreA > 99 || scoreB > 99) {
        throw new Error(`Invalid score for: ${m.teamA} vs ${m.teamB}`);
      }

      const winner = winnerFromScores(scoreA, scoreB, m.teamA, m.teamB);
      // If you don't allow ties, enforce it:
      // if (winner === "TIE") throw new Error(`No ties allowed: ${m.teamA} vs ${m.teamB}`);

      picks.push({
        matchId: m.matchId,
        teamA: m.teamA,
        teamB: m.teamB,
        scoreA,
        scoreB,
        winner
      });
    }
    return picks;
  }

  document.getElementById("submitBtn").addEventListener("click", () => {
    const status = document.getElementById("status");
    status.className = "muted";
    status.textContent = "";

    try {
      if (!API_URL.includes("/exec")) {
        throw new Error("API_URL must be your Apps Script Web App URL ending in /exec");
      }

      const name = document.getElementById("name").value.trim();
      if (!name) throw new Error("Please enter your name.");

      const picks = getPicks();

      // Fill and submit hidden form (CORS-proof)
      const form = document.getElementById("postForm");
      form.action = API_URL;

      document.getElementById("f_round").value = ROUND;
      document.getElementById("f_name").value = name;
      document.getElementById("f_picks").value = JSON.stringify(picks);

      form.submit();

      status.className = "ok";
      status.textContent = "Submitted! ✅ (Check the Google Sheet)";
    } catch (e) {
      status.className = "error";
      status.textContent = e.message;
    }
  });
</script>
</body>
</html>